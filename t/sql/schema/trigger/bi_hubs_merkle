CREATE TRIGGER bi_hubs_merkle
BEFORE INSERT ON
    hubs_merkle
FOR EACH ROW WHEN
    length(NEW.prefix) = 5
BEGIN
    SELECT debug(
        'bi_hubs_merkle',
        NEW.hub_id,
        NEW.prefix,
        NEW.hash,
        NEW.num_updates
    );
    DELETE FROM
        hubs_merkle
    WHERE
        hub_id = NEW.hub_id AND
        prefix IN (
            substr(NEW.prefix,1,1),
            substr(NEW.prefix,1,2),
            substr(NEW.prefix,1,3),
            substr(NEW.prefix,1,4),
            NEW.prefix
        )
    ;
END;