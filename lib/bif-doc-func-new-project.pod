=head1 NAME

bif-doc-func-new-project - add a new project to an update

=head1 VERSION

0.1.0_21 (2014-05-09)

=head1 SYNOPSIS

    #!sqlite
    BEGIN;

    INSERT INTO updates(...);

    INSERT INTO func_new_project(
        update_id,  -- integer NOT NULL,
        id,         -- integer NOT NULL,
        parent_id,  -- integer,
        name,       -- varchar(40),
        title       -- varchar(1024) NOT NULL DEFAULT ''
    ) VALUES (...);

    INSERT INTO func_new_project_status(...);

    INSERT INTO func_update_project(...);

    INSERT INTO func_merge_updates(...);

    COMMIT;

=head1 DESCRIPTION

The func_new_project() function creates a new project in the repository
against an in-progress update #1 by taking the following actions:

=over

=item * A row is inserted into the F<topics> table with a SHA1 hash of
the values resulting in the project/topic UUID.

=item * A row is inserted into the F<projects> table.

=item * Update #2 is started by inserting a new row into the
F<updates> table.

=item * A row is inserted into F<hub_updates> against update #2 for the
local hub with project_id set to topics.id / projects.id, which kicks
of the following trigger actions:

=over

=item * A row is inserted into F<hub_related_projects> connecting the
project to the local hub.

=item * A row is inserted into F<hub_related_updates> connecting the
update to the local hub, which kicks off the following trigger actions:

=over

=item * A row is inserted into hubs_merkle taking into account the new
update #2.

=back

=item * A row is inserted into F<hub_tomerge> but probably keeps zero
values.

=back

=item * A row is inserted into F<project_updates> against update #1, which kicks off the
following trigger actions:

=over

=item * A row is inserted into F<projects_tomerge>.

=item * A row is inserted into F<project_related_updates> connecting
update #1 to the project, which kicks off the following trigger
actions:

=over

=item * A row is inserted into projects_merkle taking into account the new
update #1.

=back


=item * If project_update.hub_uuid exists in the repository then every
project-only update from F<project_related_updates> is added to 
F<hub_related_updates> 

=back

=back

The enclosing transaction will fail with a foreign key violation unless
at least one call to
L<func_new_project_status()|bif-doc-func-new-project-status> is also
made and a row is inserted into
L<project_updates|bif-doc-table-project-updates> resulting in
C<projects.status_id> containing a valid foreign key value into the
L<project_status|bif-doc-table-project-status> table.

=head1 SEE ALSO

L<bif-doc-table-updates>, L<bif-doc-table-topics>,
L<bif-doc-table-projects>, L<bif-doc-func-new-project-status>,
L<bif-doc-table-project-updates>, L<bif-doc-func-merge-updates>

=head1 AUTHOR

Mark Lawrence E<lt>nomad@null.netE<gt>

=head1 COPYRIGHT AND LICENSE

Copyright 2013-2014 Mark Lawrence <nomad@null.net>

This program is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation; either version 3 of the License, or (at your
option) any later version.

